<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>音悦</title>
        <link rel="stylesheet" href="../css/beijing.css">
        <link rel="stylesheet" href="../css/a.css">
        <link rel="stylesheet" href="../css/a_play.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
        <link rel="stylesheet" href="../css/head.css">
        <link rel="stylesheet" href="../css/body.css">
        <link rel="stylesheet" href="../css/music_list.css">
        <link rel="stylesheet" href="../css/bottom.css">
        <link rel="stylesheet" href="../css/progressbar.css">
<!--        <script src="http://cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>-->
        <style media="screen">
            /* 勾选复选框后的样式 */
            .fa-check-square {
                color: #ffffff;
            }
            /* 底部音乐控件 */
            .player_music {
                position: absolute;
                top: 84%;
                left: 300px;
            }
            /*.player_music {*/
            /*     color: #801b17;*/
            /*    width: 30%;*/
            /*    height: 5%;*/
            /*}*/
            #play_mod {
                /* float: right; */
                position: absolute;
                top: 86%;
                left: 1100px;
            }
            .play-volume {
                width: 100px;
                height: 40px;
                position: absolute;
                top: 86%;
                left: 950px;
                display: flex;
            }
            .volume {
                margin-right: 20px;
            }
            /* 时间轴字体颜色 */
            .play_time {
                color: #CACAC9;
            }
            .lyricbox {
                width: 165%;
                height: 272px;
                margin-left: -33%;
                margin-top: 40px;
                /* background-color: #ffffff; */
                overflow: hidden;
            }
            .lyrics {
                width: 100%;
                margin-top: 30px;
                margin-left: 0px;
                text-align: center;
                /* transition: -webkit-transform 0.1s ease-out 0s; */
                transform: translateY(-13.4px); /*每次+29 根据下面设置的行高以及字体大小*/
            }
            p {
                line-height: 14px;
                font-size: 15px;
                color: #CACAC9;
            }
            .on {
                color: #00CC00;
            }
        </style>
    </head>
    <body>
        <!-- 背景图片 -->
        <div class="test1">
            <div class="bg-box2"></div>
            <div class="bg-box"></div>
            <div class="bg-box1"></div>
        </div>
        <!-- 头部1  -->
        <div class="mod_body">
            <h1 class='tatle'><a href="#">音悦</a></h1>
            <div class="mod_player_login">
                <a href="#" class="Signin">登入</a>
                <a href="#">设置</a>
            </div>
        </div>
        <div class="mod_player">
            <!-- 主体头部  -->
            <div class="player_hd"></div>
            <!-- 主体身体 -->
            <div class="player_bd">
                <!-- 默认 -->
                <div class="micbody">
                    <!-- 存放 添加删除 等等事件 -->
                    <div class="toolbar">
                        <a href="#" class="events"><i class="far fa-heart"></i>&nbsp;收藏</a>
                        <a href="#" class="events"><i class="far fa-trash-alt"></i>&nbsp;删除</a>
                        <a href="#" class="events"><i class="fas fa-eraser"></i>&nbsp;清空</a>
                    </div>
                    <!-- 歌曲列表 -->
                    <div class="gbms gbms-1">
                        <ul class="songlist_header">
                            <li class="songlist_sprite">
                                <i class="far fa-square check_box"></i>
                                <!-- <i class="far fa-check-square"></i> -->
                            </li>
                            <li class="songlist_header_name">歌曲</li>
                            <li class="songlist__header_author">歌手</li>
                            <li class="songlist__header_time">时长</li>
                        </ul>
                        <br>
                        <ul class="songlist_list">
                            <!-- <li class="songlists">
                                <div>
                                    <div class="box"><i class="far fa-square check_box"></i></div>
                                    <div class="song-name">111</div>
                                    <div class="song-author">111</div>
                                    <div class="song-time">0:00</div>
                                </div>
                            </li> -->
                        </ul>
                    </div>
                    <!-- 歌曲信息 -->
                    <div class="song_info">
                        <div class="img">
                            <!-- <div class="music-info">111<br>222<br>333</div> -->
                            <div class="music-info">
<!--                                歌曲名: 俊红妆-->
<!--                                <br>-->
<!--                                歌手名: 未知-->
                            </div>
                            <div class="lyricbox">
                                <div class="lyrics">
                                    <!-- <p>1</p>
                                    <p>2</p>
                                    <p>1</p>
                                    <p>2</p>
                                    <p>1</p>
                                    <p>2</p>
                                    <p>1</p>
                                    <p>2</p> -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 纯净模式 -->
            </div>
            <!-- 主体尾部 -->
            <div class="player_ft">
                <a id="id-playprevious" href="javascript:;" class="a_play" title="ctl+←">
                    <i class="fas fa-step-backward fa-2x"></i>
                </a>
                <a href="javascript:;" class="a_play"  id="id-play" title="[空格]">
                    <i id="id-tu-play" class="fas fa-play fa-2x"></i>
                    <!-- <i class="fas fa-pause fa-5x"></i> -->
                </a>
                <a id="id-playnext" href="javascript:;" class="a_play" title="ctl+→">
                    <i class="fas fa-step-forward fa-2x"></i>
                </a>
                <!-- 播放进度条区块 -->
                <div class="player_music" data-index="0">
                    <!-- 时间轴 -->
                    <div class="play_time">
                        <span id="id-dangqiantime">0:00</span>
                        <span>/</span>
                        <span id="id-zongtime">0:00</span>
                    </div>
                    <!-- 进度条 -->
                    <div id="demo">
                        <div class="progress">
                            <div class="progress-bar">
                                <div class="progress-thumb"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 播放音量按钮 -->
                <div class="play-volume">
                    <a href="javascript:;" id="volume-min" class="volume" title="音量减少">
                        <i class="fas fa-volume-down fa-2x"></i>
                    </a>
                    <a href="javascript:;" id="volume-max" class="volume" title="音量增加">
                        <i class="fas fa-volume-up fa-2x"></i>
                    </a>
                </div>
                <!-- 播放模式 -->
                <a id="play_modes" href="javascript:;" data-mode="order" title="顺序播放">
                    <!--顺序 -->
                    <i id="play_mod" class="fas fa-align-justify fa-2x"></i>
                    <!-- 随机 -->
                    <!-- <i class="fas fa-random"></i> -->
                    <!-- 单曲 -->
                    <!-- <i class="fas fa-redo"></i> -->
                </a>
                <audio src="https://v1.itooi.cn/tencent/url?id=0010e3Cd0kZt9S" id="id-audio-player"></audio>
            </div>
        </div>
        <script src="../js/Commontools.js"></script>
        <script>
            "use strict";
            // 存放歌曲
            // musics.song.lyrics
            // log(musics.song.lyrics[i][1]) 歌词
            // log(musics.song.lyrics[i][0]) 时间
            var musics = {}
            musics.song = {
                name:[],
                singer: [],
                url: [],
                lrc: [],
                pic: [],
                time: [],
                lyrics: [],
            }
            let total_index = 0
            // 歌单复选框
            const bindEventbox = () => {
                let box = e('.gbms')
                box.addEventListener('click', (event) => {
                    let self = event.target
                    let frame = self.classList.contains('fa-square')
                    let hook = self.classList.contains('fa-check-square')
                    if (frame) {
                        self.classList.remove('fa-square')
                        self.classList.add('fa-check-square')
                    } else if (hook) {
                        self.classList.remove('fa-check-square')
                        self.classList.add('fa-square')
                    }
                })
            }
            // 播放暂停开关
            const playSwitch = () => {
                let mp3 = e('#id-audio-player')
                let play = e('#id-play')
                let tu_play = e('#id-tu-play')
                // 快捷键空格 播放/暂停 需要设置一个 bool
                // 每次按空格的时候根据 状态(true/false) 来实现播放 暂停
                let status = false
                window.addEventListener('keydown', (event) => {
                    let key = event.key
                    if (key === ' ') {
                        if (status === false) {
                            status = true
                            tu_play.classList.remove('fa-play')
                            tu_play.classList.add('fa-pause')
                            mp3.play()
                        } else if (status === true) {
                            status = false
                            tu_play.classList.remove('fa-pause')
                            tu_play.classList.add('fa-play')
                            mp3.pause()
                        }
                    }
                })

                play.addEventListener('click', (event) => {
                    if (tu_play.classList.contains('fa-play')) {
                        tu_play.classList.remove('fa-play')
                        tu_play.classList.add('fa-pause')
                        mp3.play()
                    } else if (tu_play.classList.contains('fa-pause')) {
                        tu_play.classList.remove('fa-pause')
                        tu_play.classList.add('fa-play')
                        mp3.pause()
                    }
                })
            }
            // 补0
            const pad = function (num, n) {
               let y='00000000000000000000000000000'+num; //爱几个0就几个，自己够用就行
               return y.substr(y.length-n);
            }
            // 时间戳
            const Timeline = () => {
                let a = e("#id-audio-player")
                a.addEventListener('canplay', (event) => {
                    // 如果要计算 duration 只能在 canplay 这个事件中完成
                    // 获得总时间
                    let time_zong = a.duration
                    // let time_dq = a.currentTime
                    // 找存放总时间的元素
                    let zong = e("#id-zongtime")
                    // dq.innerHTML = ""\
                    // log(time_zong)
                    let zong_min = Math.floor(time_zong / 60)
                    let zong_sec = Math.floor(time_zong - zong_min * 60)
                    // 处理过后的 分 秒
                    let zong_sec_new = pad(zong_sec, 2)
                    let zong_min_new = pad(zong_min, 2)
                    if (parseInt(zong_min) <= 9) {
                        zong_min_new = pad(zong_min, 1)
                    }
                    zong.innerHTML = zong_min_new+ ":"+ zong_sec_new
                    // 添加不断变化的分秒
                    setInterval(function() {
                        // 找存放当前时间的元素
                        let time_dq = a.currentTime
                        let time_zong1 = a.duration
                        let dq = e("#id-dangqiantime")
                        //获得当前分钟
                        let dq_min = Math.floor(time_dq / 60)
                        // 获得当前秒
                        let dq_sec = Math.floor(time_dq - dq_min * 60)
                        // 处理过后的 分 秒
                        let dq_sec_new = pad(dq_sec, 2)
                        let dq_min_new = pad(dq_min, 2)
                        if (parseInt(dq_min) <= 9) {
                            dq_min_new = pad(dq_min, 1)
                        }
                        // log("sec =", dq_sec_new, "min =", dq_min_new)
                        dq.innerHTML = dq_min_new+ ":"+ dq_sec_new
                        let bar = e('.progress-bar')
                        let percent = Math.ceil((time_dq / time_zong1) * 100)
                        // log(percent, '当前时间 =', time_dq, '总时间 =', time_zong1)
                        let width1 = bar.style.cssText=`width:${percent}%;`
                    }, 1000)
                })
                a.addEventListener('ended', (event) => {
                    log('播放结束！')
                    let modes = e("#play_modes")
                    if (modes.title === '顺序播放') {
                        log('触发！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！', modes.title)
                        total_index += 1
                        console.log('total_index-------', total_index)
                    } else if (modes.title === '随机播放') {
                        // let array = musics.song.url
                        // total_index = choice(array)
                    } else if (modes.title === '单曲循环') {
                        // total_index = total_index
                    }
                })
            }
            // 以下是测试
            // class Songindex {
            //     constructor() {
            //         this.index = 0
            //     }
            // }
            // 下一首歌曲下标
            // 下一首歌曲下标
            const nextSong = (() => {
                let music = e('.player_music')
                // 定义需要使用的变量
                let songs = musics.song.url
                // 定义一个函数, 这个函数用到了上面定义的变量
                const f = function() {
                    if (music.dataset.index !== String(songs.length - 1)) {
                        // music.dataset.index = Number(music.dataset.index) + 1
                        music.dataset.index = Number(total_index)
                        console.log('music.dataset.index', music.dataset.index)
                    } else {
                        music.dataset.index = '0'
                    }
                    // log(Number(music.dataset.index))
                    return songs[Number(music.dataset.index)]
                }

                // 返回这个函数, 注意, 返回的不是函数的调用结果, 而是这个函数
                return f
            })()
            // 上一首歌曲下标
            const previousSong = (() => {
                let music = e('.player_music')
                // 定义需要使用的变量
                let songs = musics.song.url
                // 定义一个函数, 这个函数用到了上面定义的变量
                const f = function() {
                    if (music.dataset.index !== '0') {
                        music.dataset.index = Number(total_index)
                        console.log('上一首', music.dataset.index)
                    } else {
                        music.dataset.index = String(songs.length - 1)
                    }
                    log(Number(music.dataset.index))
                    return songs[Number(music.dataset.index)]
                }

                // 返回这个函数, 注意, 返回的不是函数的调用结果, 而是这个函数
                return f
            })()
            // 得到数组长度的随机数
            const choice = (array) => {
                // 1. 得到  0 - 1 之间的小数 a
                // 2. 把 a 转成 0 - array.length 之间的小数
                // 3. 得到 0 - array.length - 1 之间的整数作为下标
                // 4. 得到 array 中的随机元素
                // 得到0 - 10 的整数
                let num = Math.floor(Math.random() * array.length)
                return num
            }
            // 播放模式的状态
            const playMode_status = () => {
                let mode = e("#play_mod")
                let modes = e("#play_modes")
                // let data_mode = modes.dataset.mode
                mode.addEventListener("click", (event) => {
                    // fa-align-justify
                    // fa-random
                    // fa-redo
                    if (mode.classList.contains('fa-align-justify')) {
                        // 顺序模式
                        mode.classList.remove('fa-align-justify')
                        mode.classList.add('fa-random')
                        modes.dataset.mode = 'ran'
                        modes.title = '随机播放'
                        log(modes)
                    } else if (mode.classList.contains('fa-random')) {
                        //随机模式
                        mode.classList.remove('fa-random')
                        mode.classList.add('fa-redo')
                        modes.dataset.mode = 'single'
                        modes.title = '单曲循环'
                        log(modes)
                    } else if (mode.classList.contains('fa-redo')) {
                        //单曲循环
                        mode.classList.remove('fa-redo')
                        mode.classList.add('fa-align-justify')
                        modes.dataset.mode = 'order'
                        modes.title = "顺序播放"
                        log(modes)
                    }
                })
            }
            // 播放模式
            const playMode = () => {
                let a = e('#id-audio-player')
                let modes = e('#play_modes')
                a.addEventListener('ended', (event) => {
                    if (modes.dataset.mode === 'single') {
                        // 重新渲染插图 以及 歌手 歌名信息
                        let music = e('.player_music')
                        // let index = Number(music.dataset.index)
                        let index = total_index
                        let name = musics.song.name[index]
                        let singer = musics.song.singer[index]
                        log('单曲》》》', index, name, singer)

                        let info = e(".music-info")
                        let html = templetMusicInfo(name, singer)
                        info.innerHTML =  html

                        let img = e(".img")
                        let pic = e(`[data-index='${index}']`).dataset.pic
                        // log("pic =", pic)
                        img.style.backgroundImage = `url('${pic}')`

                        // 重新渲染歌词
                        e(".lyrics").innerHTML = ""
                        e(".lyrics").style.transform = `translatey(-13.4px)`
                        let lrc = e(`[data-index='${index}']`).dataset.lrc
                        // log('lrc =', lrc)
                        loadMusicLyrics(lrc)
                        bindEventMusicLrc()

                        // 重新渲染背景图片bg-box
                        let bg = e(".bg-box")
                        bg.style.backgroundImage = `url('${pic}')`
                        // 单曲循环功能
                        a.currentTime = 0
                        log(a)
                        a.play()
                    } else if (modes.dataset.mode === 'order') {
                        // 顺序播放功能
                        // 重新渲染插图 以及 歌手 歌名信息
                        let music = e('.player_music')
                        // let index = Number(music.dataset.index)
                        let index = total_index
                        console.log('顺序播放后的index', index)
                        let name = musics.song.name[index]
                        let singer = musics.song.singer[index]
                        log(name, singer)

                        let info = e(".music-info")
                        let html = templetMusicInfo(name, singer)
                        info.innerHTML =  html

                        let img = e(".img")
                        let pic = e(`[data-index='${index}']`).dataset.pic
                        // log("pic =", pic)
                        img.style.backgroundImage = `url('${pic}')`

                        // 给双击的歌曲标题增加 正在播放样式
                        // 先重制所有的歌单颜色
                        let totalList = es('.song-name')
                        for (let i = 0; i < totalList.length; i++) {
                            totalList[i].parentNode.style.color = '#CACAC9'
                        }
                        let selected = e(`.song-name[data-index='${total_index}']`)     // 获取当前选择的元素
                        selected.parentNode.style.color = 'chartreuse'

                        // 重新渲染歌词
                        e(".lyrics").innerHTML = ""
                        e(".lyrics").style.transform = `translatey(-13.4px)`
                        let lrc = e(`[data-index='${index}']`).dataset.lrc
                        // log('lrc =', lrc)
                        loadMusicLyrics(lrc)
                        bindEventMusicLrc()

                        // 重新渲染背景图片bg-box
                        let bg = e(".bg-box")
                        bg.style.backgroundImage = `url('${pic}')`


                        // 播放音乐
                        let song = nextSong()
                        a.src = song
                        log(a)
                        a.play()
                    } else if (modes.dataset.mode === 'ran') {
                        // 随机播放功能
                        let array = musics.song.url
                        // log('顺序', array)
                        // 获取随机的数组下标
                        // ../mp3s/1.mp3
                        let index = choice(array)
                        total_index = index
                        log('获取随机播放下标', total_index)
                        let music = e('.player_music')
                        let name = musics.song.name[index]
                        let singer = musics.song.singer[index]
                        log(name, singer)
                        let info = e(".music-info")
                        let html = templetMusicInfo(name, singer)
                        info.innerHTML =  html
                        a.src = array[index]

                        let img = e(".img")
                        let pic = e(`[data-index='${index}']`).dataset.pic
                        // log("pic =", pic)
                        img.style.backgroundImage = `url('${pic}')`

                        // 给双击的歌曲标题增加 正在播放样式
                        // 先重制所有的歌单颜色
                        let totalList = es('.song-name')
                        for (let i = 0; i < totalList.length; i++) {
                            totalList[i].parentNode.style.color = '#CACAC9'
                        }
                        let selected = e(`.song-name[data-index='${total_index}']`)     // 获取当前双击选择的元素
                        selected.parentNode.style.color = 'chartreuse'

                        // 重新渲染歌词
                        e(".lyrics").innerHTML = ""
                        e(".lyrics").style.transform = `translatey(-13.4px)`
                        let lrc = e(`[data-index='${index}']`).dataset.lrc
                        // log('lrc =', lrc)
                        loadMusicLyrics(lrc)
                        bindEventMusicLrc()

                        // 重新渲染背景图片bg-box
                        let bg = e(".bg-box")
                        bg.style.backgroundImage = `url('${pic}')`

                        log(a)
                        a.play()
                    }
                })
            }
            //下一首按钮
            const playnext = () => {
                let a = e('#id-audio-player')
                let next = e('#id-playnext')
                let modes = e('#play_modes')
                next.addEventListener('click', (event) => {
                    if (modes.dataset.mode === 'ran') {
                        // 随机播放功能
                        let array = musics.song.url
                        // 获取随机的数组下标
                        let index = choice(array)
                        total_index = index

                        // 给双击的歌曲标题增加 正在播放样式
                        // 先重制所有的歌单颜色
                        let totalList = es('.song-name')
                        for (let i = 0; i < totalList.length; i++) {
                            totalList[i].parentNode.style.color = '#CACAC9'
                        }
                        let selected = e(`.song-name[data-index='${total_index}']`)     // 获取当前双击选择的元素
                        selected.parentNode.style.color = 'chartreuse'

                        // 重新渲染插图 以及 歌手 歌名信息
                        let name = musics.song.name[index]
                        let singer = musics.song.singer[index]
                        log('单曲》》》', index, name, singer)

                        let info = e(".music-info")
                        let html = templetMusicInfo(name, singer)
                        info.innerHTML =  html

                        let img = e(".img")
                        let pic = e(`[data-index='${index}']`).dataset.pic
                        // log("pic =", pic)
                        img.style.backgroundImage = `url('${pic}')`

                        // 重新渲染歌词
                        e(".lyrics").innerHTML = ""
                        e(".lyrics").style.transform = `translatey(-13.4px)`
                        let lrc = e(`[data-index='${index}']`).dataset.lrc
                        // log('lrc =', lrc)
                        loadMusicLyrics(lrc)
                        bindEventMusicLrc()

                        // 重新渲染背景图片bg-box
                        let bg = e(".bg-box")
                        bg.style.backgroundImage = `url('${pic}')`

                        // 随机播放
                        a.src = array[index]
                        log(a)
                        a.play()
                    } else if (modes.dataset.mode === 'single' || modes.dataset.mode === 'order') {
                        // 顺序播放
                        // 重新渲染插图 以及 歌手 歌名信息
                        let music = e('.player_music')
                        // let index = Number(music.dataset.index)
                        total_index += 1
                        let index = total_index
                        let name = musics.song.name[index]
                        let singer = musics.song.singer[index]
                        log('单曲》》》', index, name, singer)

                        let info = e(".music-info")
                        let html = templetMusicInfo(name, singer)
                        info.innerHTML =  html

                        let img = e(".img")
                        let pic = e(`[data-index='${index}']`).dataset.pic
                        // log("pic =", pic)
                        img.style.backgroundImage = `url('${pic}')`

                        // 给双击的歌曲标题增加 正在播放样式
                        // 先重制所有的歌单颜色
                        let totalList = es('.song-name')
                        for (let i = 0; i < totalList.length; i++) {
                            totalList[i].parentNode.style.color = '#CACAC9'
                        }
                        let selected = e(`.song-name[data-index='${total_index}']`)     // 获取当前双击选择的元素
                        selected.parentNode.style.color = 'chartreuse'


                        // 重新渲染歌词
                        e(".lyrics").innerHTML = ""
                        e(".lyrics").style.transform = `translatey(-13.4px)`
                        let lrc = e(`[data-index='${index}']`).dataset.lrc
                        // log('lrc =', lrc)
                        loadMusicLyrics(lrc)
                        bindEventMusicLrc()

                        // 重新渲染背景图片bg-box
                        let bg = e(".bg-box")
                        bg.style.backgroundImage = `url('${pic}')`
                        // 顺序播放功能
                        let song = nextSong()
                        a.src = song
                        log(a)
                        a.play()
                    }
                })
            }
            //上一首按钮
            const playprevious = () => {
                let a = e('#id-audio-player')
                let previous = e('#id-playprevious')
                let modes = e('#play_modes')
                previous.addEventListener('click', (event) => {
                    if (modes.dataset.mode === 'ran') {
                        // 随机播放功能
                        let array = musics.song.url
                        // 获取随机的数组下标
                        let index = choice(array)
                        total_index = index

                        // 给双击的歌曲标题增加 正在播放样式
                        // 先重制所有的歌单颜色
                        let totalList = es('.song-name')
                        for (let i = 0; i < totalList.length; i++) {
                            totalList[i].parentNode.style.color = '#CACAC9'
                        }
                        let selected = e(`.song-name[data-index='${total_index}']`)     // 获取当前双击选择的元素
                        selected.parentNode.style.color = 'chartreuse'

                        // 重新渲染插图 以及 歌手 歌名信息
                        let name = musics.song.name[index]
                        let singer = musics.song.singer[index]
                        log('单曲》》》', index, name, singer)

                        let info = e(".music-info")
                        let html = templetMusicInfo(name, singer)
                        info.innerHTML =  html

                        let img = e(".img")
                        let pic = e(`[data-index='${index}']`).dataset.pic
                        // log("pic =", pic)
                        img.style.backgroundImage = `url('${pic}')`

                        // 重新渲染歌词
                        e(".lyrics").innerHTML = ""
                        e(".lyrics").style.transform = `translatey(-13.4px)`
                        let lrc = e(`[data-index='${index}']`).dataset.lrc
                        // log('lrc =', lrc)
                        loadMusicLyrics(lrc)
                        bindEventMusicLrc()

                        // 重新渲染背景图片bg-box
                        let bg = e(".bg-box")
                        bg.style.backgroundImage = `url('${pic}')`

                        // 随机播放
                        a.src = array[index]
                        // log(a)
                        a.play()
                    } else if (modes.dataset.mode === 'single' || modes.dataset.mode === 'order') {
                        // 顺序播放
                        // 重新渲染插图 以及 歌手 歌名信息
                        let music = e('.player_music')
                        // let index = Number(music.dataset.index)
                        total_index -= 1
                        let index = total_index
                        let name = musics.song.name[index]
                        let singer = musics.song.singer[index]
                        log('单曲》》》', index, name, singer)

                        let info = e(".music-info")
                        let html = templetMusicInfo(name, singer)
                        info.innerHTML =  html

                        let img = e(".img")
                        let pic = e(`[data-index='${index}']`).dataset.pic
                        // log("pic =", pic)
                        img.style.backgroundImage = `url('${pic}')`

                        // 给双击的歌曲标题增加 正在播放样式
                        // 先重制所有的歌单颜色
                        let totalList = es('.song-name')
                        for (let i = 0; i < totalList.length; i++) {
                            totalList[i].parentNode.style.color = '#CACAC9'
                        }
                        let selected = e(`.song-name[data-index='${total_index}']`)     // 获取当前双击选择的元素
                        selected.parentNode.style.color = 'chartreuse'

                        // 重新渲染歌词
                        e(".lyrics").innerHTML = ""
                        e(".lyrics").style.transform = `translatey(-13.4px)`
                        let lrc = e(`[data-index='${index}']`).dataset.lrc
                        // log('lrc =', lrc)
                        loadMusicLyrics(lrc)
                        bindEventMusicLrc()

                        // 重新渲染背景图片bg-box
                        let bg = e(".bg-box")
                        bg.style.backgroundImage = `url('${pic}')`
                        // 顺序播放功能
                        let song = previousSong()
                        a.src = song
                        log(a)
                        a.play()
                    }
                })
            }
            // 音量+
            const playvolume_min = () => {
                // volume-min
                let min = e("#volume-min")
                let a = e('#id-audio-player')
                min.addEventListener('click', (event) => {
                    log(a.volume)
                    if (a.volume >= 0.1) {
                        a.volume -= 0.1
                    } else {
                        a.volume = 0
                    }
                })
            }
            // 音量-
            const playvolume_max = () => {
                // volume-min
                let max = e("#volume-max")
                let a = e('#id-audio-player')
                max.addEventListener('click', (event) => {
                    log(a.volume)
                    if (a.volume <= 0.9) {
                        a.volume += 0.1
                    } else {
                        a.volume = 1
                    }
                })
            }
            // 时间轴拖拽
            const playdrag = () => {
                let progress = e('.progress')
                // log(progress)
                progress.addEventListener('click', (event) => {
                    // 找到 变化进度条 bar
                    let bar = e('.progress-bar')
                    // 找到 总进度条 progress
                    let progress = e('.progress')
                    //获取变化进度条的width
                    let width = window.getComputedStyle(bar,null).width
                    // 获取总进度图的width
                    let zong_width = window.getComputedStyle(progress,null).width
                    let widthint = parseInt(zong_width)
                    log("widthint==", widthint)
                    // 获得在进度条上单击的 X 坐标
                    let x = event.screenX - 300
                    let x1 = String(x)
                    log('x1 ===', x1)
                    let a = e("#id-audio-player")
                    // 获得总时间
                    let time_zong = a.duration
                    // 获得当前时间
                    let time_dq = a.currentTime
                    // 获得百分比的时间
                    let percent = x1 / widthint * 100
                    //进度条跳转设置
                    let width1 = bar.style.cssText=`width:${percent}%;`
                    log("6666", percent)
                    // 歌曲时间跳转设置
                    a.currentTime = percent / 100 * time_zong
                    // log(a.currentTime)
                    // 播放歌曲
                    let tu_play = e('#id-tu-play')
                    tu_play.classList.remove('fa-play')
                    tu_play.classList.add('fa-pause')

                    a.play()
                })
            }

            // 数据存入 localStorage
            const saveSong = (songs) => {
                songlist.push(songs)
                let s = JSON.stringify(songlist)
                localStorage.savedSongs = s
            }
            let songlist = []

            //ajax获取歌曲
            const loadSong = () => {
                let method = 'GET'
                let path = "https://v1.itooi.cn/tencent/songList?id=6749153717&pageSize=100&page=0&format=1"
                let data = ''
                ajax(method, path, data, (song) => {
                    let song1 = JSON.parse(song)
                    let songs = song1.data
                    saveSong(songs)
                })
            }

            // 把获取到的歌曲数据存入之前定义的数组中
            const Song = (music_song, songs, leixing) => {
                console.log(songs)
                for (let i = 0; i < songs.length; i++) {
                    if (leixing === 'lrc') {
                        music_song[leixing].push(`https://v1.itooi.cn/tencent/lrc?id=${songs[i].id}`)
                    } else {
                        music_song[leixing].push(songs[i][leixing])
                    }
                }
            }
            // 把数据进行分类
            const pushSong = () => {
                let songs1 = JSON.parse(localStorage.savedSongs)
                // log(songs1[0][0].name)
                Song(musics.song, songs1[0], 'name')       //歌名
                Song(musics.song, songs1[0], "singer")   //歌手
                Song(musics.song, songs1[0], "time")       //歌曲时间
                Song(musics.song, songs1[0], "pic")         //图片
                Song(musics.song, songs1[0], "url")         //歌曲地址
                Song(musics.song, songs1[0], "lrc")         //歌词
                log('musics >>>>', musics)
            }

            // 渲染歌曲列表
            const templet = (name, singer, url, time, pic, lrc, i) => {
                let zong_min = Math.floor(time / 60)
                let zong_sec = Math.floor(time - zong_min * 60)
                // 处理过后的 分 秒
                let zong_sec_new = pad(zong_sec, 2)
                let zong_min_new = pad(zong_min, 2)
                let t = `
                    <li class="songlists">
                        <div class="songBox">
                            <div class="box"><i class="far fa-square check_box"></i></div>
                                <div class="song-name" data-url=${url} data-pic=${pic} data-lrc=${lrc} data-index=${i-1}>${i}&nbsp&nbsp${name}</div>
                            <div class="song-author">${singer}</div>
                            <div class="song-time">${zong_min_new}:${zong_sec_new}</div>
                        </div>
                    </li>
                `
                return t
            }
            const loadSongList = () => {
                let songs = musics.song
                log(songs)
                let songlist_list = e(".songlist_list")
                for (let i = 0; i < songs.name.length; i++) {
                    let name = songs.name[i]
                    let singer = songs.singer[i]
                    let url = songs.url[i]
                    let time = songs.time[i]
                    let pic = songs.pic[i]
                    let lrc = songs.lrc[i]
                    let html = templet(name, singer, url, time, pic, lrc, i+1)
                    songlist_list.insertAdjacentHTML('beforeend', html)
                }
            }

            // 给插图下方渲染 歌曲信息
            const templetMusicInfo = (name, singer) => {
                let t = `
                    <div class="music-info">
                        歌曲名: ${name}
                        <br>
                        歌手名: ${singer}
                    </div>
                `
                return t
            }

            // 用ajax 获得歌词 并且处理之后 保存进 musics.song.lyrics
            const ajaxLoadLyrics = (path) => {
                let method = 'GET'
                let data = ''
                musics.song.lyrics = []
                log('歌词>>>', path)
                ajax(method, path, data, (song) => {
                    // 把拿到的歌词根据换行 把每行 歌词都push进一个数组中
                    let lrc = song.split('\n')
                    let a = []
                    for (let i = 5; i < lrc.length; i++) {
                        a.push(lrc[i])
                    }
                    // 通过遍历 把未处理的数组数据 进行分割 左边存放秒数时间 右边存放歌词
                    for (let i = 0; i < a.length; i++) {
                        let time = a[i].slice(1).split(']')[0]
                        let value = a[i].slice(1).split(']')[1]
                        let min_time = Number(time.split(':')[0]) * 60
                        let sec_time = Number(time.split(':')[1])
                        let time1 = min_time + sec_time
                        if (value !== '') {
                            musics.song.lyrics.push([time1, value])
                        }
                    }
                    // log(musics.song.lyrics)
                })
            }

            // 渲染歌词
            const templetMusicLrc = (i, value) => {
                let t = `
                    <p data-index=${i}>${value[i][1]}</p>
                `
                return t
            }
            const loadMusicLyrics = (path) => {
                // log('获得歌词', path)
                ajaxLoadLyrics(path)
                let lrc = musics.song.lyrics
                let lrcs = e(".lyrics")
                // log(lrc[6][1])
                for (let i = 0; i < lrc.length; i++) {
                    // log(lrc[i][1])
                    // log(lrc[i])
                    log('进行渲染')
                    let html = templetMusicLrc(i, lrc)
                    lrcs.insertAdjacentHTML('beforeend', html)
                }
            }

            // 绑定歌曲列表双击事件
            // 给动态添加的歌曲列表绑定事件 并且更新页面右边的插图及播放信息
            const bindEventSongList = () => {
                let a = e('#id-audio-player')
                let box = e('.gbms')
                box.addEventListener('dblclick', (event) => {
                    let self = event.target
                    if (self.classList.contains('song-name')) {
                        let url = self.dataset.url
                        let pic = self.dataset.pic

                        e(".lyrics").innerHTML = ""
                        e(".lyrics").style.transform = `translatey(-13.4px)`

                        // 更改歌词信息
                        let lrc = self.dataset.lrc
                        loadMusicLyrics(lrc)
                        bindEventMusicLrc()
                        // 更改背景图片bg-box
                        let bg = e(".bg-box")
                        bg.style.backgroundImage = `url('${pic}')`

                        let index = Number(self.dataset.index)
                        total_index = index
                        // 给双击的歌曲标题增加 正在播放样式
                        // 先重制所有的歌单颜色
                        let totalList = es('.song-name')
                        for (let i = 0; i < totalList.length; i++) {
                            totalList[i].parentNode.style.color = '#CACAC9'
                        }
                        let selected = e(`.song-name[data-index='${total_index}']`)     // 获取当前双击选择的元素
                        selected.parentNode.style.color = 'chartreuse'

                        // 更改插图下面的信息
                        console.log('双击歌曲列表 下标更改', total_index)
                        let name = musics.song.name[index]
                        let singer = musics.song.singer[index]
                        log(name, singer)

                        let info = e(".music-info")
                        let html = templetMusicInfo(name, singer)
                        info.innerHTML = html
                        let img = e(".img")
                        img.style.backgroundImage = `url('${pic}')`


                        //设置播放歌曲地址
                        let tu_play = e('#id-tu-play')
                        tu_play.classList.remove('fa-play')
                        tu_play.classList.add('fa-pause')
                        a.src = url
                        a.play()
                    }
                })
            }

            // 绑定事件 查看歌词事件 和播放音乐的当前时间是否对上 对上的话就给当前歌词加上高亮(歌词滚动效果)
            const bindEventMusicLrc = () => {
                let a = e("#id-audio-player")
                // log(musics.song.lyrics[0][0])
                let lrc = musics.song.lyrics
                // let p = e("p[data-index='2']")
                // p.classList.add("on")
                // log(p)
                a.addEventListener('timeupdate', (event) => {
                    for (let i = 0; i < lrc.length; i++) {
                        let p = e(`p[data-index='${i}']`)
                        // log(p.classList)
                        if (p !== null) {
                            p.classList.remove('on')
                        }
                    }
                    // 上移量(translatey)
                    let translatey = 0
                    for (let i = 0; i < lrc.length; i++) {
                        if (a.currentTime > lrc[i][0]) {
                            // transform: translateY(-13.4px); /*每次+34*/
                            if (i !== 0) {
                                let p = e(`p[data-index='${i}']`)
                                // log(p_index.innerHTML)
                                if (p !== null) {
                                    p.classList.add('on')
                                }

                                let p1 = e(`p[data-index='${i-1}']`)
                                // log(p_index.innerHTML)
                                if (p1 !== null) {
                                    p1.classList.remove('on')
                                }
                                if (i >= 5) {
                                    translatey += 30
                                    // log('上移量=', test)
                                    e(".lyrics").style.transform = `translatey(-${translatey}px)`
                                }
                                // log('i=', i)
                            } else {
                                // log(lrc[i][1])
                                let p = e(`p[data-index='${i}']`)
                                // log(p_index.innerHTML)
                                p.classList.add('on')
                            }
                        }
                    }
                })
            }

            // 整合播放模式
            const playModes = () => {
                playMode_status()
                playMode()
            }
            // 整合上一首下一首按钮
            const cutsong = () => {
                playprevious()
                playnext()
            }
            // 整合两个音量
            const playvolume = () => {
                playvolume_min()
                playvolume_max()
            }

            const __main = () => {
                //获取歌曲
                loadSong()
                //存入歌曲
                pushSong()
                // 复选框
                bindEventbox()
                // 播放开关
                playSwitch()
                // 时间轴
                Timeline()
                // 播放模式
                playModes()
                // 上一首下一首
                cutsong()
                // 进度条拖拽
                playdrag()
                //音量
                playvolume()
                // 渲染歌曲列表
                loadSongList()
                // 绑定歌曲列表事件
                bindEventSongList()
            }

            __main()
        </script>
    </body>
</html>
